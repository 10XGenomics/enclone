#!/bin/csh

# Run cargo t and another test which it's not clear how to encapsulate within cargo t.  This
# also does some tidying and reports time used.  Note that the effect of cargo t is defined 
# by .cargo/config.
#
# If you change the tests here, make sure to edit the GitHub Actions accordingly.

/usr/bin/time -f %E \
    cargo t \
    |& grep --line-buffered -v "^running" \
    | grep --line-buffered -v " Running "

if ( $status != 0 ) then
    echo "FAILED!"
    exit 1
endif

/usr/bin/time -f %E \
    cargo test -p enclone_tail --lib -- --nocapture \
    |& egrep -v "Finished|Running" | grep -v "^running"

if ( $status != 0 ) then
    echo "FAILED!"
    exit 1
endif

echo
