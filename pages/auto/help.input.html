<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--  -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xml+xhtml; charset=UTF-8"/>
<title>enclone help input</title>
<style type="text/css">
@font-face {
    font-family: "DejaVuSansMono";
    src:
    local("Menlo Regular"),
    url('https://cdn.jsdelivr.net/npm/@deathbeds/jupyterlab-font-dejavu-sans-mono@1.0.0/style/fonts/DejaVuSansMono.woff2')
    format("woff2"),
    url('https://cdn.jsdelivr.net/npm/dejavu-fonts-ttf@2.37.3/ttf/DejaVuSansMono.ttf')
    format("truetype"),
    url('../fonts/DejaVuLGCSansMono.ttf') format("truetype"),
    local("Courier New");
}
@font-face {
    font-family: "DejaVuSansMono";
    font-weight: bold;
    src:
    local("Menlo Bold"),
    url('https://cdn.jsdelivr.net/npm/@deathbeds/jupyterlab-font-dejavu-sans-mono@1.0.0/style/fonts/DejaVuSansMono-Bold.woff2')
    format("woff2"),
    url('https://cdn.jsdelivr.net/npm/dejavu-fonts-ttf@2.37.3/ttf/DejaVuSansMono-Bold.ttf')
    format("truetype"),
    url('../fonts/DejaVuLGCSansMono-Bold.ttf') format("truetype"),
    local("Courier New Bold");
}
</style>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-58278925-3"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){{dataLayer.push(arguments);}}
gtag('js', new Date());
gtag('config', 'UA-58278925-3');
</script>
</head>
<body>

<br>
<a href="../../index.html#help">
<img src="../../img/enclone_banner.png" alt="enclone banner" title="enclone banner" width=100% />
</a>
<pre style='font-family: "DejaVuSansMono"; line-height: 110%'><span style="font-size: 14px">
enclone has <span style="color:#c23621;font-weight:bold;">two</span> mechanisms for specifying input datasets: either directly on the command line or
via a supplementary metadata file. Only one mechanism may be used at a time.

In both cases, you will need to provide paths to directories where the outputs of the Cell Ranger
pipeline may be found.  enclone uses only some of the pipeline output files, so it is enough that
those files are present in given directory, and the particular files that are needed may be found
by typing <a href="../../pages/auto/help.input_tech.html"><code>enclone help input_tech</code></a>.

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃If you use the argument <span style="font-weight:bold;">PRE=p</span> then <span style="font-weight:bold;">p/</span> will be prepended to all pipeline paths.  A comma-separated ┃
┃list is also allowed <span style="font-weight:bold;">PRE=p1,...,pn</span>, in which case these directories are searched from left to     ┃
┃right, until one works, and if all fail, the path is used without prepending anything.  Lastly,   ┃
┃(see <a href="../../pages/auto/help.command.html"><code>enclone help command</code></a>), you can avoid putting <span style="font-weight:bold;">PRE</span> on the command line by setting the          ┃
┃environment variable <span style="font-weight:bold;">ENCLONE_PRE</span> to the desired value.  The default value for <span style="font-weight:bold;">PRE</span> is              ┃
┃<span style="font-weight:bold;">~/enclone/datasets_me,~/enclone/datasets,~/enclone/datasets2</span>.  There is also an argument <span style="font-weight:bold;">PREPOST=x</span>┃
┃that causes <span style="font-weight:bold;">/x</span> to be appended to all entries in <span style="font-weight:bold;">PRE</span>.                                              ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

Both input forms involve abbreviated names (discussed below), which should be as short as
possible, as longer abbreviations will increase the width of the clonotype displays.

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃enclone can use gene expression and feature barcode data, as represented by a feature matrix.     ┃
┃Cell Ranger stores this matrix in an hdf5 file, which while generally very efficient, is not      ┃
┃optimized for interactive use.  Therefore enclone provides an alternate file structure, which     ┃
┃speeds up enclone overall by up to <span style="color:#c23621;font-weight:bold;">50%</span>.  To use this, add the argument <span style="font-weight:bold;">NH5</span> to the enclone command ┃
┃line.  This will work so long as you have write permission on input directories.  The first time  ┃
┃you run enclone (using given inputs), an alternate file feature_barcode_matrix.bin will be        ┃
┃written; then subsequent invocations will be faster.  Once the file has been created, it will     ┃
┃always be used, regardless of whether <span style="font-weight:bold;">NH5</span> is used.  However, we may occasionally change the format┃
┃of the alternate file.  If do that, then if you have previously generated the file, then it will  ┃
┃be rewritten when you invoke enclone for that dataset.  Like with other enclone command-line      ┃
┃options, if you want <span style="font-weight:bold;">NH5</span> on all the time, you can set the environment variable <span style="font-weight:bold;">ENCLONE_NH5</span>.       ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

<span style="color:#c23621;font-weight:bold;">█ 1 █</span> To point directly at input files on the command line, use e.g.
<span style="font-weight:bold;">TCR=/home/jdoe/runs/dataset345</span>
or likewise for <span style="font-weight:bold;">BCR</span>.  A more complicated syntax is allowed in which commas, colons and semicolons
act as delimiters.  Commas go between datasets from the same origin, colons between datasets from
the same donor, and semicolons separate donors.  If semicolons are used, the value must be quoted.

enclone uses the distinction between datasets, origins and donors in the following ways:
1. If two datasets come from the same origin, then enclone can filter to remove certain artifacts,
unless you specify the option <span style="font-weight:bold;">NCROSS</span>.
See also illusory clonotype expansion page at <span style="color:#25bc24;">bit.ly/enclone</span>.
2. If two cells came from different donors, then enclone will not put them in the same clonotype,
unless you specify the option <span style="font-weight:bold;">MIX_DONORS</span>.
More information may be found at `enclone help special`.  In addition, this is enclone's way of
keeping datasets organized and affects the output of fields like origin, etc.

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight:bold;">Naming.</span>  Using this input system, each dataset is assigned an abbreviated name, which is         ┃
┃everything after the final slash in the directory name (e.g. <span style="font-weight:bold;">dataset345</span> in the above example), or┃
┃the entire name if there is no slash; origins and donors are assigned identifiers s1,... and     ┃
┃d1,..., respectively; numbering of origins restarts with each new donor.  <span style="font-weight:bold;">To specify origins</span>     ┃
┃<span style="font-weight:bold;">and donors, use the second input form, and see in particular</span> <span style="color:#25bc24;">abbr:path</span><span style="font-weight:bold;">.</span>                          ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

Examples:
<span style="font-weight:bold;">TCR=p1,p2</span>   -- input data from two libraries from the same origin
<span style="font-weight:bold;">TCR=p1,p2:q</span> -- input data as above plus another from a different origin from the same donor
<span style="font-weight:bold;">TCR="a;b"</span>   -- input one library from each of two donors.

Matching gene expression and/or feature barcode data may also be supplied using an argument <span style="font-weight:bold;">GEX=...</span>,
whose right side must have the exact same structure as the <span style="font-weight:bold;">TCR</span> or <span style="font-weight:bold;">BCR</span> argument.  Specification of
both <span style="font-weight:bold;">TCR</span> and <span style="font-weight:bold;">BCR</span> is not allowed.  If both BCR and GEX data are in the same directory (from a multi
run), and single argument <span style="font-weight:bold;">BCR_GEX=...</span> may be used, and similarly one may use <span style="font-weight:bold;">TCR_GEX</span>.

In addition, barcode-level data may be specified using <span style="font-weight:bold;">BC=...</span>, whose right side is a list of paths
having the same structure as the <span style="font-weight:bold;">TCR</span> or <span style="font-weight:bold;">BCR</span> argument.  Each such path must be for a CSV or TSV
file, which must include the field <span style="font-weight:bold;">barcode</span>, may include special fields <span style="font-weight:bold;">origin</span>, <span style="font-weight:bold;">donor</span>, <span style="font-weight:bold;">tag</span> and <span style="font-weight:bold;">color</span>,
and may also include arbitrary other fields.  The <span style="font-weight:bold;">origin</span> and <span style="font-weight:bold;">donor</span> fields allow a particular
origin and donor to be associated to a given barcode.  A use case for this is genetic
demultiplexing.  The <span style="font-weight:bold;">tag</span> field is intended to be used with tag demultiplexing.  The <span style="font-weight:bold;">color</span> field is
used by the <span style="font-weight:bold;">PLOT</span> option.  All other fields are treated as lead variables, but values are only
displayed in <span style="font-weight:bold;">PER_CELL</span> mode, or for parseable output using <span style="font-weight:bold;">PCELL</span>.  These fields should not include
existing lead variable names.  Use of <span style="font-weight:bold;">BC</span> automatically turns on the <span style="font-weight:bold;">MIX_DONORS</span> option.

Alternatively, an argument <span style="font-weight:bold;">BC_JOINT=filename</span> may be specified, where the filename is a CSV or TSV
file like those for <span style="font-weight:bold;">BC=...</span>, but with an additional field <span style="font-weight:bold;">dataset</span>, whose value is an abbreviated
dataset name, and which enables the information to be split up to mirror the specification of <span style="font-weight:bold;">TCR</span>
or <span style="font-weight:bold;">BCR</span>.

The argument <span style="font-weight:bold;">BC=...</span> or equivalently <span style="font-weight:bold;">BC_JOINT=filename</span> may be used on conjunction with
<span style="font-weight:bold;">KEEP_CELL_IF=...</span> (see <a href="../../pages/auto/help.special.html"><code>enclone help special</code></a>) to restrict the barcodes used by enclone to a
specified set.

<span style="color:#c23621;font-weight:bold;">█ 2 █</span> To specify a metadata file, use the command line argument
<span style="font-weight:bold;">META=filename</span>
This file should be a CSV (comma-separated values) file, with one line per cell group.  After the
first line, blank lines and lines starting with # are ignored.  There must be a field tcr or bcr,
and some other fields are allowed:
┌────────┬───────────────┬──────────────────────────────────────────────────────────────┐
│<span style="font-weight:bold;">field</span>   │  <span style="font-weight:bold;">default</span>      │  <span style="font-weight:bold;">meaning</span>                                                     │
├────────┼───────────────┼──────────────────────────────────────────────────────────────┤
│tcr     │  (required!)  │  path to dataset, or abbr:path, where abbr is an abbreviated │
│or bcr  │               │  name for the dataset; exactly one of tcr or bcr must be used│
├────────┼───────────────┼──────────────────────────────────────────────────────────────┤
│gex     │  null         │  path to GEX dataset, which may include or consist entirely  │
│        │               │  of FB data                                                  │
├────────┼───────────────┼──────────────────────────────────────────────────────────────┤
│origin  │  s1           │  abbreviated name of origin                                  │
├────────┼───────────────┼──────────────────────────────────────────────────────────────┤
│donor   │  d1           │  abbreviated name of donor                                   │
├────────┼───────────────┼──────────────────────────────────────────────────────────────┤
│color   │  null         │  color to associate to this dataset (for <span style="font-weight:bold;">PLOT</span> option)        │
├────────┼───────────────┼──────────────────────────────────────────────────────────────┤
│bc      │  null         │  name of CSV file as in the <span style="font-weight:bold;">BC</span> option                        │
└────────┴───────────────┴──────────────────────────────────────────────────────────────┘

Multiple <span style="font-weight:bold;">META</span> arguments are cumulative and we also allow <span style="font-weight:bold;">META</span> to be a comma-separated list of
filenames.  In both cases the <span style="font-weight:bold;">META</span> files must have identical header lines.  In addition, metadata
maybe fully specified on the command line via <span style="font-weight:bold;">METAX="l1;...;ln"</span> where the <span style="font-weight:bold;">li</span> are the lines that
you would otherwise put in the <span style="font-weight:bold;">META</span> file.
<span style="color:#c23621;font-weight:bold;">█ 3 █</span> enclone can also read an ancillary CSV file that specifies arbitrary fields that are
associated to particular immune receptor sequences.  This is done using <span style="font-weight:bold;">INFO=path.csv</span>; The CSV
file must have fields <span style="font-weight:bold;">vj_seq1</span>, specifying the full heavy or TRB sequence from the beginning of the
V segment to the end of the J segment, and <span style="font-weight:bold;">vj_seq2</span>, for the light or TRA chain.  The other fields
are then made accessible as lvars (see <a href="../../pages/auto/help.lvars.html"><code>enclone help lvars</code></a>), which are populated for any exact
subclonotype having exactly two chains (heavy/light or TRB/TRA) that match the data in the CSV
file.  By default, one cannot have two lines for the same antibody, however a separate argument
<span style="font-weight:bold;">INFO_RESOLVE</span> may be used to "pick the first one".</span></pre>
</body>
</html>
