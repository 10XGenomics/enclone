<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--  -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xml+xhtml; charset=UTF-8"/>
<title>enclone help input</title>
<link href='../enclone.css' rel='stylesheet' type='text/css'>
</head>
<body>
<pre style='font-family: "DejaVuSansMono"; line-height: 110%'><span style="font-size: 14px">
enclone has <span style="color:#c23621;font-weight:bold;">two</span> mechanisms for specifying input datasets: either directly on the command line or
via a supplementary metadata file. Only one mechanism may be used at a time.

In both cases, you will need to provide paths to directories where the outputs of the Cell Ranger
pipeline may be found.  enclone uses only some of the pipeline output files, so it is enough that
those files are present in given directory, and the particular files that are needed may be found
by typing <span style="font-weight:bold;">enclone help input_tech</span>.

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃If you use the argument <span style="font-weight:bold;">PRE=p</span> then <span style="font-weight:bold;">p/</span> will be prepended to all pipeline paths.  A comma-separated┃
┃list is also allowed <span style="font-weight:bold;">PRE=p1,...,pn</span>, in which case these directories are searched from left to    ┃
┃right, until one works, and if all fail, the path is used without prepending anything.  Lastly,  ┃
┃(see <span style="font-weight:bold;">enclone help command</span>), you can avoid putting <span style="font-weight:bold;">PRE</span> on the command line by setting the         ┃
┃environment variable <span style="font-weight:bold;">ENCLONE_PRE</span> to the desired value.                                           ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

Both input forms involve abbreviated names (discussed below), which should be as short as
possible, as longer abbreviations will increase the width of the clonotype displays.

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃enclone can use gene expression and feature barcode data, as represented by a feature matrix.    ┃
┃Cell Ranger stores this matrix in an hdf5 file, which while generally very efficient, is not     ┃
┃optimized for interactive use.  Therefore enclone provides an alternate file structure, which    ┃
┃speeds up enclone overall by up to <span style="color:#c23621;font-weight:bold;">50%</span>.  To use this, add the argument <span style="font-weight:bold;">NH5</span> to the enclone command┃
┃line.  This will work so long as you have write permission on input directories.  The first time ┃
┃you run enclone (using given inputs), an alternate file feature_barcode_matrix.bin will be       ┃
┃written; then subsequent invocations will be faster.  Once the file has been created, it will    ┃
┃always be used, regardless of whether <span style="font-weight:bold;">NH5</span> is used.  Like with other enclone command-line options,┃
┃if you want <span style="font-weight:bold;">NH5</span> on all the time, you can set the environment variable <span style="font-weight:bold;">ENCLONE_NH5</span>.               ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

<span style="color:#c23621;font-weight:bold;">█ 1 █</span> To point directly at input files on the command line, use e.g.
<span style="font-weight:bold;">TCR=/home/jdoe/runs/sample345</span>
or likewise for <span style="font-weight:bold;">BCR</span>.  A more complicated syntax is allowed in which commas, colons and semicolons
act as delimiters.  Commas go between datasets from the same sample, colons between datasets from
the same donor, and semicolons separate donors.  If semicolons are used, the value must be quoted.

enclone uses the distinction between datasets, samples and donors in the following ways:
1. If two datasets come from the same sample, then enclone can filter to remove certain artifacts,
unless you specify the option <span style="font-weight:bold;">NCROSS</span>.
See also <span style="color:#25bc24;">https://10xgenomics.github.io/enclone/pages/auto/expanded.html</span>.
2. If two cells came from different donors, then enclone will not put them in the same clonotype,
unless you specify the option <span style="font-weight:bold;">MIX_DONORS</span>.
More information may be found at `enclone help special`.  In addition, this is enclone's way of
keeping datasets organized and affects the output of fields like sample, etc.

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight:bold;">Naming.</span>  Using this input system, each dataset is assigned an abbreviated name, which is        ┃
┃everything after the final slash in the directory name (e.g. <span style="font-weight:bold;">sample345</span> in the above example), or┃
┃the entire name if there is no slash; samples and donors are assigned identifers s1,... and     ┃
┃d1,..., respectively; numbering of samples restarts with each new donor.  <span style="font-weight:bold;">To specify samples</span>    ┃
┃<span style="font-weight:bold;">and donors, use the second input form, and see in particular</span> <span style="color:#25bc24;">abbr:path</span><span style="font-weight:bold;">.</span>                         ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

Examples:
<span style="font-weight:bold;">TCR=p1,p2</span>   -- input data from two libraries from the same sample
<span style="font-weight:bold;">TCR=p1,p2:q</span> -- input data as above plus another from a different sample from the same donor
<span style="font-weight:bold;">TCR="a;b"</span>   -- input one library from each of two donors.

Matching gene expression and/or feature barcode data may also be supplied using an argument <span style="font-weight:bold;">GEX=...</span>,
whose right side must have the exact same structure as the <span style="font-weight:bold;">TCR</span> or <span style="font-weight:bold;">BCR</span> argument.  Specification of
both <span style="font-weight:bold;">TCR</span> and <span style="font-weight:bold;">BCR</span> is not allowed.

In addition, barcode-level data may be specified using <span style="font-weight:bold;">BC=...</span>, whose right side is a list of paths
having the same structure as the <span style="font-weight:bold;">TCR</span> or <span style="font-weight:bold;">BCR</span> argument.  Each such path must be for a CSV file,
which must include the field <span style="font-weight:bold;">barcode</span>, may include special fields <span style="font-weight:bold;">sample</span>, <span style="font-weight:bold;">donor</span>, <span style="font-weight:bold;">tag</span> and <span style="font-weight:bold;">color</span>, and
may also include arbitrary other fields.  The <span style="font-weight:bold;">sample</span> and <span style="font-weight:bold;">donor</span> fields allow a particular sample
and donor to be associated to a given barcode.  A use case for this is genetic demultiplexing. 
The <span style="font-weight:bold;">tag</span> field is intended to be used with tag demultiplexing.  The <span style="font-weight:bold;">color</span> field is used by the <span style="font-weight:bold;">PLOT</span>
option.  All other fields are treated as lead variables, but values are only displayed in <span style="font-weight:bold;">PER_CELL</span>
mode, or for parseable output using <span style="font-weight:bold;">PCELL</span>.  These fields should not include existing lead variable
names.  Use of <span style="font-weight:bold;">BC</span> automatically turns on the <span style="font-weight:bold;">MIX_DONORS</span> option.

<span style="color:#c23621;font-weight:bold;">█ 2 █</span> To specify a metadata file, use the command line argument
<span style="font-weight:bold;">META=filename</span>
This file should be a CSV (comma-separated values) file, with one line per cell group.  After the
first line, lines starting with # are ignored.  There must be a field tcr or bcr, and some other
fields are allowed:
┌────────┬───────────────┬──────────────────────────────────────────────────────────────┐
│<span style="font-weight:bold;">field</span>   │  <span style="font-weight:bold;">default</span>      │  <span style="font-weight:bold;">meaning</span>                                                     │
├────────┼───────────────┼──────────────────────────────────────────────────────────────┤
│tcr     │  (required!)  │  path to dataset, or abbr:path, where abbr is an abbreviated │
│or bcr  │               │  name for the dataset; exactly one of tcr or bcr must be used│
│gex     │  null         │  path to GEX dataset, which may include or consist entirely  │
│        │               │  of FB data                                                  │
├────────┼───────────────┼──────────────────────────────────────────────────────────────┤
│sample  │  s1           │  abbreviated name of sample                                  │
├────────┼───────────────┼──────────────────────────────────────────────────────────────┤
│donor   │  d1           │  abbreviated name of donor                                   │
├────────┼───────────────┼──────────────────────────────────────────────────────────────┤
│color   │  null         │  color to associate to this dataset (for <span style="font-weight:bold;">PLOT</span> option)        │
├────────┼───────────────┼──────────────────────────────────────────────────────────────┤
│bc      │  null         │  name of CSV file as in the <span style="font-weight:bold;">BC</span> option                        │
└────────┴───────────────┴──────────────────────────────────────────────────────────────┘

</span></pre>
</body>
</html>
